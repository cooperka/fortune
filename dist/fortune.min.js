/*!
 * Fortune.js
 * Version 5.4.1
 * MIT License
 * http://fortune.js.org
 */
!function e(r,t,n){function o(s,a){if(!t[s]){if(!r[s]){var u="function"==typeof require&&require;if(!a&&u)return u(s,!0);if(i)return i(s,!0);var c=new Error("Cannot find module '"+s+"'");throw c.code="MODULE_NOT_FOUND",c}var f=t[s]={exports:{}};r[s][0].call(f.exports,function(e){var t=r[s][1][e];return o(t||e)},f,f.exports,e,r,t,n)}return t[s].exports}for(var i="function"==typeof require&&require,s=0;s<n.length;s++)o(n[s]);return o}({1:[function(e,r,t){(function(r){"use strict";function n(e,r,t){var n;return null===t?null===r:e?e.compare?0===e.compare(r,t):(n=c(m,function(r){return r[0]===e.prototype.constructor}))?n[1](r,t):r===t:r===t}function o(e,r){return function(t){return e[y]?c(r,function(r){return n(e[d],t,r)}):n(e[d],t,r)}}function i(e,r,t){var n;for(n in r)switch(n){case"and":if(!function(e,r,t){var n;for(n=0;n<r.length;n++)if(!i(e,r[n],t))return!1;return!0}(e,r[n],t))return!1;break;case"or":if(!function(e,r,t){var n;for(n=0;n<r.length;n++)if(i(e,r[n],t))return!0;return!1}(e,r[n],t))return!1;break;case"not":if(i(e,r[n],t))return!1;break;case"range":if(!function(e,r,t){var n,o,i,a,u,f,l={};for(n in r)if(o=e[n],i=o[d],a=o[y],i||a){if(u=r[n],null==(f=t[n]))return!1;if(a&&(f=f?f.length:0),l[n]||(l[n]=a?c(g,s(Number))[1]:i.compare||c(g,s(i))[1]),null!==u[0]&&l[n](f,u[0])<0)return!1;if(null!==u[1]&&l[n](u[1],f)<0)return!1}return!0}(e,r[n],t))return!1;break;case"match":if(!function(e,r,t){var n,i;for(n in r)if(i=r[n],Array.isArray(i)||(i=[i]),void 0===c(i,o(e[n],t[n])))return!1;return!0}(e,r[n],t))return!1;break;case"exists":if(!function(e,r,t){var n,o,i;for(n in r)if(o=t[n],i=e[n][y],r[n]){if(!o)return!1;if(i&&!o.length)return!1}else{if(o&&!i)return!1;if(i&&o.length)return!1}return!0}(e,r[n],t))return!1}return!0}function s(e){return function(r){return r[0]===e.prototype.constructor}}var a=e("../../common/deep_equal"),u=e("../../common/message"),c=e("../../common/array/find"),f=e("../../common/generate_id"),l=e("../../common/errors").BadRequestError,p=e("../../common/keys"),h=p.primary,d=p.type,y=p.isArray,m=[[Date,function(e,r){return e.getTime()===r.getTime()}],[r,function(e,r){return e.equals(r)}],[Object,function(e,r){return a(e,r)}]],g=[[Number,function(e,r){return e-r}],[String,function(e,r){return e===r?0:e>r?1:-1}],[Boolean,function(e,r){return e===r?0:e?1:-1}],[Date,function(e,r){return e.getTime()-r.getTime()}],[r,r.compare],[Object,function(){return 0}]];t.generateId=f,t.applyOptions=function(e,r,t,n){var o,a,f,p,m,v,w,b,E;if(t||(t={}),n||(n={}),v=n.language,t)for(w=r,r=[],b=0,E=w.length;b<E;b++)a=w[b],i(e,t,a)&&r.push(a);if(o=r.length,"fields"in t){if(p=!c(Object.keys(t.fields),function(e){return!t.fields[e]}),m=!c(Object.keys(t.fields),function(e){return t.fields[e]}),!p&&!m)throw new l(u("FieldsFormat",v));for(b=0,E=r.length;b<E;b++){a=r[b];for(f in a)f!==h&&(p&&!t.fields.hasOwnProperty(f)||m&&t.fields.hasOwnProperty(f))&&delete a[f]}}return"sort"in t&&(r=r.sort(function(e,r){var t,n,o,i,a,u,f,l,p;return function(h,m){for(t in r){if(o=h[t],i=m[t],a=r[t],u=e[t],f=u[y],l=u[d],null===o)return 1;if(null===i)return-1;if(p=0,f)p=o.length-i.length;else if(l){if(!(n=l.compare||c(g,s(l))[1]))throw new Error('Missing "compare" function.');p=n(o,i)}if(0!==p)return a?p:-p}return 0}}(e,t.sort))),("limit"in t||"offset"in t)&&(r=r.slice(t.offset,t.limit?(t.offset||0)+t.limit:r.length)),r.count=o,r}}).call(this,e("buffer").Buffer)},{"../../common/array/find":8,"../../common/deep_equal":19,"../../common/errors":20,"../../common/generate_id":22,"../../common/keys":24,"../../common/message":25,buffer:46}],2:[function(e,r,t){"use strict";var n=e("../common").generateId;t.inputRecord=function(e,r){var t,o,i,s=this.recordTypes,a=this.keys.primary,u=this.keys.isArray,c=s[e],f=Object.getOwnPropertyNames(c),l={};l[a]=a in r?r[a]:n();for(t=0,o=f.length;t<o;t++)i=f[t],r.hasOwnProperty(i)?l[i]=r[i]:l[i]=c[i][u]?[]:null;return l},t.outputRecord=function(e,r){var t,n,o,i,s,a=this.recordTypes,u=this.keys.primary,c=this.keys.isArray,f=this.keys.denormalizedInverse,l=a[e],p=Object.getOwnPropertyNames(l),h={};for(h[u]=r[u],t=0,n=p.length;t<n;t++)o=p[t],s=(i=r.hasOwnProperty(o))?r[o]:l[o][c]?[]:null,l[o][f]?Object.defineProperty(h,o,{configurable:!0,writable:!0,value:s}):i&&(h[o]=s);return h}},{"../common":1}],3:[function(e,r,t){"use strict";var n=e("../../../common/apply_update"),o=e("../../../common/array/map"),i=e("../../../common/promise"),s=e("../common"),a=s.applyOptions,u=e("./helpers"),c=u.inputRecord,f=u.outputRecord;r.exports=function(e){function r(r){e.call(this,r),this.options||(this.options={}),"recordsPerType"in this.options||(this.options.recordsPerType=1e3)}return r.prototype=new e,r.prototype.connect=function(){var e,r=i.Promise,t=this.recordTypes;this.db={};for(e in t)this.db[e]={};return r.resolve()},r.prototype.disconnect=function(){var e=i.Promise;return delete this.db,e.resolve()},r.prototype.find=function(r,t,n,o){var s,u,c,l,p=i.Promise,h=this.recordTypes[r],d=this.db[r],y=[];if(t&&!t.length)return e.prototype.find.call(this);if(t)for(s=0,u=t.length;s<u;s++)c=t[s],d.hasOwnProperty(c)&&(l=d[c],delete d[c],d[c]=l,y.push(f.call(this,r,l)));else for(c in d)y.push(f.call(this,r,d[c]));return p.resolve(a(h,y,n,o))},r.prototype.create=function(e,r,t){var n,s,a,u,l,p,h=i.Promise,d=this,y=d.message,m=d.options.recordsPerType,g=d.keys.primary,v=d.errors.ConflictError,w=d.db[e];for(t||(t={}),p=t.language,n=0,s=(r=o(r,function(r){return c.call(d,e,r)})).length;n<s;n++)if(a=r[n],u=a[g],w.hasOwnProperty(u))return h.reject(new v(y("RecordExists",p,{id:u})));for(n=0,s=r.length;n<s;n++)w[(a=r[n])[g]]=a;if(m&&(l=Object.keys(w)).length>m)for(n=0,s=(l=l.slice(0,l.length-m)).length;n<s;n++)delete w[l[n]];return h.resolve(o(r,function(r){return f.call(d,e,r)}))},r.prototype.update=function(r,t){var o,s,a,u,l,p=i.Promise,h=this.keys.primary,d=this.db[r],y=0;if(!t.length)return e.prototype.update.call(this);for(o=0,s=t.length;o<s;o++)(l=d[u=(a=t[o])[h]])&&(y++,l=f.call(this,r,l),n(l,a),delete d[u],d[u]=c.call(this,r,l));return p.resolve(y)},r.prototype.delete=function(r,t){var n,o,s,a=i.Promise,u=this.db[r],c=0;if(t&&!t.length)return e.prototype.delete.call(this);if(t)for(n=0,o=t.length;n<o;n++)u[s=t[n]]&&(delete u[s],c++);else for(s in u)delete u[s],c++;return a.resolve(c)},r.common=s,r.features={logicalOperators:!0},r}},{"../../../common/apply_update":6,"../../../common/array/map":10,"../../../common/promise":27,"../common":1,"./helpers":2}],4:[function(e,r,t){"use strict";function n(e){o(this,e)}var o=e("../common/assign"),i=e("../common/promise"),s=e("./adapters/memory");n.prototype.constructor=function(){},delete n.prototype.constructor,n.prototype.connect=function(){return i.Promise.resolve()},n.prototype.disconnect=function(){return i.Promise.resolve()},n.prototype.create=function(){return i.Promise.resolve([])},n.prototype.find=function(){var e=i.Promise,r=[];return r.count=0,e.resolve(r)},n.prototype.update=function(){return i.Promise.resolve(0)},n.prototype.delete=function(){return i.Promise.resolve(0)},n.prototype.beginTransaction=function(){return i.Promise.resolve(this)},n.prototype.endTransaction=function(){return i.Promise.resolve()},n.prototype.applyOperators=function(e){return e},n.DefaultAdapter=s(n),n.features={},r.exports=n},{"../common/assign":14,"../common/promise":27,"./adapters/memory":3}],5:[function(e,r,t){"use strict";var n=e("./"),o=e("../common"),i=e("../common/errors"),s=e("../common/keys"),a=e("../common/promise");r.exports=function(e){var r,t;if("function"!=typeof(t=Array.isArray(e.adapter)?e.adapter:[e.adapter])[0])throw new TypeError("The adapter must be a function.");if(r=n.prototype.isPrototypeOf(t[0].prototype)?t[0]:t[0](n),!n.prototype.isPrototypeOf(r.prototype))throw new TypeError("The adapter must inherit the Adapter class.");return new r({options:t[1]||{},recordTypes:e.recordTypes,features:r.features,common:o,errors:i,keys:s,message:e.message,Promise:a.Promise})}},{"../common":23,"../common/errors":20,"../common/keys":24,"../common/promise":27,"./":4}],6:[function(e,r,t){"use strict";var n=e("./array/pull");r.exports=function(e,r){var t;for(t in r.replace)e[t]=r.replace[t];for(t in r.push)e[t]=e[t]?e[t].concat(r.push[t]):[].concat(r.push[t]);for(t in r.pull)e[t]=e[t]?n(e[t],r.pull[t]):[]}},{"./array/pull":11}],7:[function(e,r,t){"use strict";r.exports=function(e,r){var t,n,o=[],i=0;for(t=0,n=e.length;t<n;t++)r(e[t],t,e)&&(o[i++]=e[t]);return o}},{}],8:[function(e,r,t){"use strict";r.exports=function(e,r){var t,n,o;for(t=0,n=e.length;t<n;t++)if(o=e[t],r(o))return o}},{}],9:[function(e,r,t){"use strict";r.exports=function(e,r){var t,n;for(t=0,n=e.length;t<n;t++)if(e[t]===r)return!0;return!1}},{}],10:[function(e,r,t){"use strict";r.exports=function(e,r){var t,n,o=[],i=0;for(t=0,n=e.length;t<n;t++)o[i++]=r(e[t],t,e);return o}},{}],11:[function(e,r,t){"use strict";r.exports=function(e,r){var t,n,o,i={},s=[];if(Array.isArray(r))for(n=0,o=r.length;n<o;n++)i[r[n]]=!0;else i[r]=!0;for(n=e.length;n--;)t=e[n],i.hasOwnProperty(t)||s.push(t);return s}},{}],12:[function(e,r,t){"use strict";r.exports=function(e,r,t){var n,o,i=t;for(n=0,o=e.length;n<o;n++)i=r(i,e[n],n,e);return i}},{}],13:[function(e,r,t){"use strict";r.exports=function(e){var r,t,n,o={},i=[];for(r=0,t=e.length;r<t;r++)n=e[r],o.hasOwnProperty(n)||(i.push(n),o[n]=!0);return i}},{}],14:[function(e,r,t){"use strict";r.exports=function(e){var r,t,n,o;for(r=1,t=arguments.length;r<t;r++)if(null!=(o=arguments[r]))for(n in o)e[n]=o[n];return e}},{}],15:[function(e,r,t){"use strict";r.exports=function(e){var r=Number.parseFloat(e);return e-r+1>=0?r:e}},{}],16:[function(e,r,t){(function(t){"use strict";var n=e("./errors"),o=e("./message"),i=e("./cast_to_number"),s=n.BadRequestError,a=t.from||function(e,r){return new t(e,r)},u=[[Number,function(e){return parseFloat(e)}],[Date,function(e,r){if("string"==typeof e&&(e=Date.parse(e),Number.isNaN(e)))throw new s(o("DateISO8601",r.language));if(e=new Date(e),Number.isNaN(e.getTime()))throw new s(o("DateInvalid",r.language));return e}],[t,function(e,r){var t=r&&r.bufferEncoding?r.bufferEncoding:"base64";if("string"!=typeof e)throw new s(o("BufferEncoding",r.language,{bufferEncoding:t}));return a(e,t)}],[Boolean,function(e){return"string"==typeof e?/^(?:true|1|yes|t|y)$/i.test(e):Boolean(e)}],[Object,function(e,r){if("string"==typeof e)return JSON.parse(e);if("object"==typeof e)return e;throw new s(o("JSONParse",r.language))}],[String,function(e){return""+e}]];r.exports=function(e,r,t){var n,o,s,a;if(""===e)return null;if(!r)return i(e);for(n=0,o=u.length;n<o;n++)if((s=u[n])[0]===r){a=s[1];break}return a&&null!==e?a(e,t):e}}).call(this,e("buffer").Buffer)},{"./cast_to_number":15,"./errors":20,"./message":25,buffer:46}],17:[function(e,r,t){"use strict";r.exports=function e(r){var t,n,o,i;if(Array.isArray(r))i=!0;else if(null==r||Object.getPrototypeOf(r)!==Object.prototype)return r;t=i?[]:{};for(n in r)o=r[n],t[n]=null!==o&&void 0!==o&&Object.getPrototypeOf(o)===Object.prototype||Array.isArray(o)?e(o):o;return t}},{}],18:[function(e,r,t){"use strict";var n,o,i,s="function"==typeof Symbol,a=["denormalizedInverse","updateRecord","linkedHash"];for(t.primary="id",t.type="type",t.link="link",t.inverse="inverse",t.isArray="isArray",n=0,o=a.length;n<o;n++)t[i=a[n]]=s?Symbol(i):"__"+i+"__";t.change="change",t.sync="sync",t.connect="connect",t.disconnect="disconnect",t.failure="failure",t.find="find",t.create="create",t.update="update",t.delete="delete"},{}],19:[function(e,r,t){(function(e){"use strict";function t(r,n){var o,i,s,a=0,u=0;if(r===n)return!0;if(!r||!n)return!1;if(r.prototype!==n.prototype)return!1;for(o in r)if(a++,i=r[o],s=n[o],"object"!=typeof i){if(e.isBuffer(i)){if(!e.isBuffer(s)||!i.equals(s))return!1}else if(i&&"function"==typeof i.getTime){if(!s||"function"!=typeof s.getTime||i.getTime()!==s.getTime())return!1}else if(i!==s)return!1}else if("object"!=typeof s||!t(i,s))return!1;for(o in n)u++;return a===u}r.exports=t}).call(this,{isBuffer:e("../../node_modules/is-buffer/index.js")})},{"../../node_modules/is-buffer/index.js":50}],20:[function(e,r,t){"use strict";var n=e("./response_classes");t.BadRequestError=n.BadRequestError,t.UnauthorizedError=n.UnauthorizedError,t.ForbiddenError=n.ForbiddenError,t.NotFoundError=n.NotFoundError,t.MethodError=n.MethodError,t.NotAcceptableError=n.NotAcceptableError,t.ConflictError=n.ConflictError,t.UnsupportedError=n.UnsupportedError,t.UnprocessableError=n.UnprocessableError,t.nativeErrors=n.nativeErrors},{"./response_classes":28}],21:[function(e,r,t){"use strict";var n=e("./constants");t.change=n.change,t.sync=n.sync,t.connect=n.connect,t.disconnect=n.disconnect,t.failure=n.failure},{"./constants":18}],22:[function(e,r,t){"use strict";var n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",o=n.length;r.exports=function(){var e,r=[];for(e=0;e<15;e++)r.push(n.charAt(Math.floor(Math.random()*o)));return r.join("")}},{}],23:[function(e,r,t){"use strict";r.exports={constants:e("./constants"),keys:e("./keys"),events:e("./events"),methods:e("./methods"),assign:e("./assign"),castToNumber:e("./cast_to_number"),castValue:e("./cast_value"),clone:e("./clone"),deepEqual:e("./deep_equal"),generateId:e("./generate_id"),message:e("./message"),responses:e("./response_classes"),errors:e("./errors"),successes:e("./success"),filter:e("./array/filter"),find:e("./array/find"),includes:e("./array/includes"),map:e("./array/map"),pull:e("./array/pull"),reduce:e("./array/reduce"),unique:e("./array/unique")}},{"./array/filter":7,"./array/find":8,"./array/includes":9,"./array/map":10,"./array/pull":11,"./array/reduce":12,"./array/unique":13,"./assign":14,"./cast_to_number":15,"./cast_value":16,"./clone":17,"./constants":18,"./deep_equal":19,"./errors":20,"./events":21,"./generate_id":22,"./keys":24,"./message":25,"./methods":26,"./response_classes":28,"./success":29}],24:[function(e,r,t){"use strict";var n=e("./constants");t.primary=n.primary,t.type=n.type,t.link=n.link,t.isArray=n.isArray,t.inverse=n.inverse,t.denormalizedInverse=n.denormalizedInverse},{"./constants":18}],25:[function(e,r,t){"use strict";function n(e,r,t){var o,i,s;if(n.hasOwnProperty(r)||((s=r&&r.match(/.+?(?=-)/))&&(s=s[0]),r=n.hasOwnProperty(s)?s:n.defaultLanguage),!n[r].hasOwnProperty(e))return n[r].GenericError||n.en.GenericError;o=n[r][e];for(i in t)o=o.replace("{"+i+"}",t[i]);return o}r.exports=n,Object.defineProperty(n,"defaultLanguage",{value:"en",writable:!0}),Object.defineProperty(n,"copy",{value:function(){var e,r=new Function("return "+n.toString())();Object.defineProperty(r,"defaultLanguage",{value:"en",writable:!0});for(e in n)r[e]=n[e];return r}}),n.en={GenericError:"An internal error occurred.",MalformedRequest:"The request was malformed.",InvalidBody:"The request body is invalid.",SerializerNotFound:'The serializer for "{id}" does not exist.',InputOnly:"Input only.",InvalidID:"An ID is invalid.",DateISO8601:"Date string must be an ISO 8601 formatted string.",DateInvalid:"Date value is invalid.",BufferEncoding:"Buffer value must be a {bufferEncoding}-encoded string.",JSONParse:"Could not parse value as JSON.",MissingPayload:"Payload is missing.",SpecifiedIDs:"IDs should not be specified.",InvalidURL:"Invalid URL.",RelatedRecordNotFound:'A related record for the field "{field}" was not found.',CreateRecordsInvalid:"There are no valid records to be created.",CreateRecordsFail:"Records could not be created.",CreateRecordMissingID:"An ID on a created record is missing.",DeleteRecordsMissingID:"IDs are required for deleting records.",DeleteRecordsInvalid:"A record to be deleted could not be found.",DeleteRecordsFail:"Not all records specified could be deleted.",UnspecifiedType:"The type is unspecified.",InvalidType:'The requested type "{type}" is not a valid type.',InvalidMethod:'The method "{method}" is unrecognized.',CollisionToOne:'Multiple records can not have the same to-one link value on the field "{field}".',CollisionDuplicate:'Duplicate ID "{id}" in the field "{field}".',UpdateRecordMissing:"A record to be updated could not be found.",UpdateRecordsInvalid:"There are no valid updates.",UpdateRecordMissingID:"An ID on an update is missing.",EnforceArrayType:'The value of "{key}" is invalid, it must be an array with values of type "{type}".',EnforceArray:'The value of "{key}" is invalid, it must be an array.',EnforceSameID:'An ID of "{key}" is invalid, it cannot be the same ID of the record.',EnforceSingular:'The value of "{key}" can not be an array, it must be a singular value.',EnforceValue:'The value of "{key}" is invalid, it must be a "{type}".',EnforceValueArray:'A value in the array of "{key}" is invalid, it must be a "{type}".',FieldsFormat:"Fields format is invalid. It may either be inclusive or exclusive, but not both.",RecordExists:'A record with ID "{id}" already exists.'}},{}],26:[function(e,r,t){"use strict";var n=e("./constants");t.find=n.find,t.create=n.create,t.update=n.update,t.delete=n.delete},{"./constants":18}],27:[function(e,r,t){"use strict";t.Promise=Promise},{}],28:[function(e,r,t){"use strict";function n(e){return Function("assign","return function "+e+" (x) { assign(this, x) }")(i)}var o=e("error-class"),i=e("./assign");t.OK=n("OK"),t.Created=n("Created"),t.Empty=n("Empty"),t.BadRequestError=o("BadRequestError"),t.UnauthorizedError=o("UnauthorizedError"),t.ForbiddenError=o("ForbiddenError"),t.NotFoundError=o("NotFoundError"),t.MethodError=o("MethodError"),t.NotAcceptableError=o("NotAcceptableError"),t.ConflictError=o("ConflictError"),t.UnsupportedError=o("UnsupportedError"),t.UnprocessableError=o("UnprocessableError"),t.nativeErrors=[Error,TypeError,ReferenceError,RangeError,SyntaxError,EvalError,URIError]},{"./assign":14,"error-class":47}],29:[function(e,r,t){"use strict";var n=e("./response_classes");t.OK=n.OK,t.Created=n.Created,t.Empty=n.Empty},{"./response_classes":28}],30:[function(e,r,t){"use strict";var n=e("../common/message"),o=e("../common/promise"),i=e("../common/array/unique"),s=e("../common/array/map"),a=e("../common/array/includes"),u=e("../common/errors").BadRequestError,c=e("../common/keys"),f=c.primary,l=c.link,p=c.isArray,h=c.inverse;r.exports=function(e,r,t,c,d){var y=o.Promise,m=this.options.settings.enforceLinks;return y.all(s(c,function(o){var c=Array.isArray(r[o])?r[o]:r.hasOwnProperty(o)&&null!==r[o]?[r[o]]:[],p=t[o][l],g=t[o][h],v={fields:{}};return v.fields[g]=!0,new y(function(r,t){return c.length?e.find(p,c,v,d).then(function(e){var l,p,h;if(m)for(l=i(s(e,function(e){return e[f]})),p=0,h=c.length;p<h;p++)if(!a(l,c[p]))return t(new u(n("RelatedRecordNotFound",d.language,{field:o})));return r(e)}):r()})})).then(function(e){var r,n,o,i={};for(n=0,o=e.length;n<o;n++)(r=e[n])&&(i[c[n]]=t[c[n]][p]?r:r[0]);return i})}},{"../common/array/includes":9,"../common/array/map":10,"../common/array/unique":13,"../common/errors":20,"../common/keys":24,"../common/message":25,"../common/promise":27}],31:[function(e,r,t){"use strict";var n=e("./validate_records"),o=e("./check_links"),i=e("../record_type/enforce"),s=e("../common/message"),a=e("../common/promise"),u=e("../common/array/map"),c=e("../common/errors").BadRequestError,f=e("./update_helpers"),l=f.scrubDenormalizedUpdates,p=f.getUpdate,h=f.addId,d=e("../common/constants"),y=d.change,m=d.create,g=d.update,v=d.primary,w=d.link,b=d.inverse,E=d.isArray,A=d.denormalizedInverse;r.exports=function(e){var r,t,f,d,k,O,T,_=a.Promise,I=this,P=I.denormalizedFields,B=I.recordTypes,x=I.hooks,R={},U=[];return _.resolve(e.request.payload).then(function(n){var o,i,a;if(!(t=n)||!t.length)throw new c(s("CreateRecordsInvalid",T));f=e.request.type,d=e.request.meta,r=e.transaction,T=d.language,k=x[f],O=B[f];for(a in O)if(w in O[a]&&U.push(a),A in O[a])for(o=0,i=t.length;o<i;o++)delete t[o][a];return"function"==typeof k[0]?_.all(u(t,function(r){return k[0](e,r)})):t}).then(function(e){return _.all(u(e,function(e,n){return e&&"object"==typeof e?t[n]=e:e=t[n],i(f,e,O,d),o.call(I,r,e,O,U,d)}))}).then(function(){return n.call(I,t,O,U,d),r.create(f,t,d)}).then(function(n){var o,i,a,f,l,y,m,g,A,k,I,P,x,j={};if(!n.length)throw new c(s("CreateRecordsFail",T));for(t=n,Object.defineProperty(e.response,"records",{configurable:!0,value:t}),o=0,i=t.length;o<i;o++){if(m=t[o],!(v in m))throw new Error(s("CreateRecordMissingID",T));for(a=0,f=U.length;a<f;a++)if(g=U[a],A=O[g][b],m.hasOwnProperty(g)&&A)for(k=O[g][w],I=B[k][A][E],P=Array.isArray(m[g])?m[g]:[m[g]],R[k]||(R[k]=[]),j[k]||(j[k]={}),l=0,y=P.length;l<y;l++)null!==(x=P[l])&&h(m[v],p(k,x,R,j),A,I)}return _.all(u(Object.keys(R),function(e){return R[e].length?r.update(e,R[e],d):null}))}).then(function(){var r,n={};n[m]={},n[m][f]=t;for(r in R)l(R[r],P),R[r].length&&(g in n||(n[g]={}),n[g][r]=R[r]);return I.emit(y,n),e})}},{"../common/array/map":10,"../common/constants":18,"../common/errors":20,"../common/message":25,"../common/promise":27,"../record_type/enforce":42,"./check_links":30,"./update_helpers":38,"./validate_records":39}],32:[function(e,r,t){"use strict";var n=e("../common/message"),o=e("../common/promise"),i=e("../common/array/map"),s=e("../common/errors").NotFoundError,a=e("./update_helpers"),u=a.scrubDenormalizedUpdates,c=a.getUpdate,f=a.removeId,l=e("../common/constants"),p=l.change,h=l.delete,d=l.update,y=l.primary,m=l.link,g=l.inverse,v=l.isArray;r.exports=function(e){var r,t,a,l=o.Promise,w=this,b=w.denormalizedFields,E=e.request,A=E.type,k=E.ids,O=E.meta,T=O.language,_=w.recordTypes,I=w.hooks,P={},B=_[A],x=I[A],R=[];r=e.transaction;for(t in B)m in B[t]&&R.push(t);if(!k||!k.length)throw new s(n("DeleteRecordsMissingID",T));return r.find(A,k,null,O).then(function(r){if((a=r).length<k.length)throw new s(n("DeleteRecordsInvalid",T));return Object.defineProperty(e.response,"records",{configurable:!0,value:a}),"function"==typeof x[0]?l.all(i(a,function(r){return x[0](e,r)})):a}).then(function(){return r.delete(A,k,O)}).then(function(e){var t,o,s,u,p,h,d,w,b,E,A,I,x,U={};if(e<k.length)throw new Error(n("DeleteRecordsFail",T));for(t=0,o=a.length;t<o;t++)for(d=a[t],s=0,u=R.length;s<u;s++)if(w=R[s],E=B[w][g],d.hasOwnProperty(w)&&E)for(A=B[w][m],I=_[A][E][v],x=Array.isArray(d[w])?d[w]:[d[w]],P[A]||(P[A]=[]),U[A]||(U[A]={}),p=0,h=x.length;p<h;p++)null!==(b=x[p])&&f(d[y],c(A,b,P,U),E,I);return l.all(i(Object.keys(P),function(e){return P[e].length?r.update(e,P[e],O):null}))}).then(function(){var r,t={};t[h]={},t[h][A]=k;for(r in P)u(P[r],b),P[r].length&&(d in t||(t[d]={}),t[d][r]=P[r]);return w.emit(p,t),e})}},{"../common/array/map":10,"../common/constants":18,"../common/errors":20,"../common/message":25,"../common/promise":27,"./update_helpers":38}],33:[function(e,r,t){"use strict";var n=e("../common/array/map"),o=e("../common/promise");r.exports=function(e){var r=o.Promise,t=this.hooks,i=e.request,s=e.response,a=i.type,u=t[a],c=s.records,f=s.include;return delete s.records,delete s.include,(c?r.all(n(c,function(t){return r.resolve("function"==typeof u[1]?u[1](e,t):t)})).then(function(o){var s,a,u;for(a=0,u=o.length;a<u;a++)o[a]&&(c[a]=o[a]);if(f)return s=Object.keys(f),r.all(n(s,function(o){return i.includeType=o,r.all(n(f[o],function(n){return r.resolve("function"==typeof t[o][1]?t[o][1](e,n):n)}))})).then(function(e){var r,t,n,o;for(delete i.includeType,r=0,t=e.length;r<t;r++)for(n=0,o=e[r].length;n<o;n++)e[r][n]&&(f[s[r]][n]=e[r][n])})}):r.resolve()).then(function(){return e.response.payload={records:c},f&&(e.response.payload.include=f),c&&"count"in c&&(e.response.payload.count=c.count),e})}},{"../common/array/map":10,"../common/promise":27}],34:[function(e,r,t){"use strict";r.exports=function(e){var r=e.transaction,t=e.request,n=t.type,o=t.ids,i=t.options,s=t.meta;return n?r.find(n,o,i,s).then(function(r){return Object.defineProperty(e.response,"records",{configurable:!0,value:r}),e}):e}},{}],35:[function(e,r,t){"use strict";var n=e("../common/promise"),o=e("../common/array/map"),i=e("../common/array/find"),s=e("../common/array/reduce"),a=e("../common/errors").BadRequestError,u=e("../common/keys"),c=u.primary,f=u.link;r.exports=function(e){var r,t,u,l=n.Promise,p=e.request,h=p.type,d=p.ids||[],y=p.include,m=p.meta,g=e.response,v=e.transaction,w=g.records,b=this.recordTypes,E=!0,A={};if(!h||!y||!w)return e;for(A[h]={},r=0,t=d.length;r<t;r++)A[h][d[r]]=!0;if(!d.length)for(r=0,t=w.length;r<t;r++)u=w[r][c],A[h][u]||(A[h][u]=!0);return y.length&&!Array.isArray(y[0])&&(y=[y]),l.all(o(y,function(e){return new l(function(r,t){var n,o,i,u,p,d,y,g=h,A=[];for(Array.isArray(e)&&(Array.isArray(e[1])||"object"!=typeof e[1])||(e=[e]),p=0,d=e.length;p<d;p++)Array.isArray(e[p])&&(A[p]=e[p][1],e[p]=e[p][0]);for(p=0,d=w.length;p<d;p++)if(!(e[0]in w[p])){E=!1;break}if(E)y=l.resolve(w);else{for((i={fields:{}}).fields[e[0]]=!0,o=[],p=0,d=w.length;p<d;p++)o.push(w[p][c]);y=v.find(h,o,i,m)}return y.then(function(r){return s(e,function(r,t,c){return r.then(function(r){if(u=b[g][t],!g||!u)return[];if(!(f in u))throw new a('The field "'+t+'" does not define a link.');return n={},g=u[f],o=s(r,function(e,r){var o,i,s,a=Array.isArray(r[t])?r[t]:[r[t]];for(o=0,i=a.length;o<i;o++)(s=a[o])&&!n[s]&&(n[s]=!0,e.push(s));return e},[]),c in A?i=A[c]:c<e.length-1?(i={fields:{}}).fields[e[c+1]]=!0:i=null,o.length?v.find(g,o,i,m):[]})},l.resolve(r))}).then(function(e){return r({type:g,ids:o,records:e})},function(e){return t(e)})})})).then(function(r){var t=s(r,function(e,r){var t,n,o,s;if(!r.ids.length)return e;for(e[r.type]||(e[r.type]=[]),A[r.type]||(A[r.type]={}),t=0,n=r.ids.length;t<n;t++)o=r.ids[t],A[r.type][o]||(s=i(r.records,function(e){return function(r){return r[c]===e}}(o)))&&(A[r.type][o]=!0,e[r.type].push(s));return e[r.type].length||delete e[r.type],e},{});return Object.keys(t).length&&Object.defineProperty(e.response,"include",{configurable:!0,value:t}),e})}},{"../common/array/find":8,"../common/array/map":10,"../common/array/reduce":12,"../common/errors":20,"../common/keys":24,"../common/promise":27}],36:[function(e,r,t){"use strict";function n(e){var r=o.Promise,t=this.flows,n=this.recordTypes,u=this.adapter,y=function(e){var r={request:{method:m,type:null,ids:null,options:{},include:[],meta:{},payload:null},response:{meta:{},payload:null}};return i(r.request,e),r}(e),v=y.request.method,w="transaction"in e;return r.resolve(y).then(function(o){var i,p=o.request.type,h=o.request.ids,d=o.request.meta.language;if(h&&(o.request.ids=s(h)),null===p)throw i=new c(a("UnspecifiedType",d)),i.isTypeUnspecified=!0,i;if(!n.hasOwnProperty(p))throw new f(a("InvalidType",d,{type:p}));if(!(v in t))throw new l(a("InvalidMethod",d,{method:v}));return w?r.resolve(e.transaction):u.beginTransaction()}).then(function(e){var n,o,i,s;for(y.transaction=e,n=r.resolve(y),i=0,s=(o=t[v]).length;i<s;i++)n=n.then(o[i]);return n}).then(function(e){return w?r.resolve():e.transaction.endTransaction().then(function(){var r=e.request.method,t=e.response;return t.payload?r===g?new d(t):new p(t):new h(t)})}).catch(function(e){function r(){throw i(e,y.response)}return"transaction"in y&&!w?y.transaction.endTransaction(e).then(r,r):r()})}var o=e("../common/promise"),i=e("../common/assign"),s=e("../common/array/unique"),a=e("../common/message"),u=e("../common/response_classes"),c=u.BadRequestError,f=u.NotFoundError,l=u.MethodError,p=u.OK,h=u.Empty,d=u.Created,y=e("../common/methods"),m=y.find,g=y.create;n.middlewares={create:e("./create"),delete:e("./delete"),update:e("./update"),find:e("./find"),include:e("./include"),end:e("./end")},r.exports=n},{"../common/array/unique":13,"../common/assign":14,"../common/message":25,"../common/methods":26,"../common/promise":27,"../common/response_classes":28,"./create":31,"./delete":32,"./end":33,"./find":34,"./include":35,"./update":37}],37:[function(e,r,t){"use strict";var n=e("../common/deep_equal"),o=e("../common/promise"),i=e("../common/assign"),s=e("../common/clone"),a=e("./validate_records"),u=e("./check_links"),c=e("../record_type/enforce"),f=e("../common/message"),l=e("../common/apply_update"),p=e("./update_helpers"),h=p.scrubDenormalizedUpdates,d=p.getUpdate,y=p.addId,m=p.removeId,g=e("../common/errors"),v=g.NotFoundError,w=g.BadRequestError,b=e("../common/array/find"),E=e("../common/array/includes"),A=e("../common/array/map"),k=e("../common/constants"),O=k.change,T=k.update,_=k.primary,I=k.link,P=k.inverse,B=k.isArray,x=k.denormalizedInverse,R=k.updateRecord,U=k.linkedHash;r.exports=function(e){var r,t,p,g,k,j,C,q=o.Promise,S=this,D=S.denormalizedFields,N=S.adapter,M=S.recordTypes,L=S.hooks,F={},z=[],V=[];return q.resolve(e.request.payload).then(function(n){var o,i,s,a;(function(e,r){var t,n,o=r.language;if(!e||!e.length)throw new w(f("UpdateRecordsInvalid",o));for(t=0,n=e.length;t<n;t++)if(!e[t][_])throw new w(f("UpdateRecordMissingID",o))})(t=n,e.request.meta),k=e.request.type,j=e.request.meta,r=e.transaction,C=j.language,p=M[k],g=L[k];for(a in p)if(I in p[a]&&V.push(a),x in p[a])for(o=0,i=t.length;o<i;o++)(s=t[o]).replace&&delete s.replace[a],s.pull&&delete s.pull[a],s.push&&delete s.push[a];return r.find(k,A(t,function(e){return e[_]}),null,j)}).then(function(o){if(o.length<t.length)throw new v(f("UpdateRecordMissing",C));return q.all(A(o,function(o){var a,h,d="function"==typeof g[0],y=o[_];if(!(a=b(t,function(e){return e[_]===y})))throw new v(f("UpdateRecordMissing",C));return d&&(h=s(a)),q.resolve(d?g[0](e,o,a):a).then(function(t){if(t&&"object"==typeof t&&(a=t),d&&(n(a,h)||(e.response.meta.updateModified=!0),a[_]!==y))throw new w(f("InvalidID",C));return z.push(a),Object.defineProperty(a,R,{value:o}),o=i({},o),l(o,a),a.operate&&(o=N.applyOperators(o,a.operate)),c(k,o,p,j),u.call(S,r,o,p,V,j).then(function(e){return Object.defineProperty(a,U,{value:e}),o})})}))}).then(function(t){var n,o;for(a.call(S,t,p,V,j),Object.defineProperty(e.response,"records",{configurable:!0,value:t}),n=0,o=z.length;n<o;n++)!function(e,r){var t;for(t in e.replace)r.hasOwnProperty(t)||delete e.replace[t];for(t in e.pull)r.hasOwnProperty(t)||delete e.pull[t];for(t in e.push)r.hasOwnProperty(t)||delete e.push[t]}(z[n],p);return r.update(k,z,j)}).then(function(){var e,t,n,o,i,s,a,u,c,f,l,h,g,v,w,b,O,T,x,C,S={};for(w=0,b=z.length;w<b;w++)for(g=z[w],O=0,T=V.length;O<T;O++)if(v=V[O],e=p[v][P]){if(t=p[v][B],n=p[v][I],o=M[n][e][B],F[n]||(F[n]=[]),S[n]||(S[n]={}),s=g[R],i=g[U],g.replace&&g.replace.hasOwnProperty(v)){if(f=g.replace[v],!Array.isArray(f)){if(f===s[v])continue;null!==f&&y(g[_],d(n,f,F,S),e,o),i.hasOwnProperty(v)&&null!==i[v][e]&&!o&&i[v][e]!==g[_]&&m(f,d(n,i[v][e],F,S),e,o),null!==s[v]&&s[v]!==g[v]&&s[v]!==f&&m(g[_],d(n,s[v],F,S),e,o);continue}for(c=f,x=0,C=s[v].length;x<C;x++)if(f=s[v][x],!E(c,f)){if("pull"in g||(g.pull={}),g.pull.hasOwnProperty(v)){if(Array.isArray(g.pull[v])){g.pull[v].push(f);continue}g.pull[v]=[g.pull[v],f];continue}g.pull[v]=[f]}for(x=0,C=c.length;x<C;x++)if(f=c[x],!E(s[v],f)){if("push"in g||(g.push={}),g.push.hasOwnProperty(v)){if(Array.isArray(g.push[v])){g.push[v].push(f);continue}g.push[v]=[g.push[v],f];continue}g.push[v]=[f]}delete g.replace[v]}if(g.pull&&g.pull[v])for(x=0,C=(h=Array.isArray(g.pull[v])?g.pull[v]:[g.pull[v]]).length;x<C;x++)null!==(f=h[x])&&m(g[_],d(n,f,F,S),e,o);if(g.push&&g.push[v])for(x=0,C=(l=Array.isArray(g.push[v])?g.push[v]:[g.push[v]]).length;x<C;x++)null!==(f=l[x])&&y(g[_],d(n,f,F,S),e,o);if(i.hasOwnProperty(v)&&!o)for(x=0,C=(u=Array.isArray(i[v])?i[v]:[i[v]]).length;x<C;x++)(a=u[x])[e]!==g[_]&&m(a[_],d(k,a[e],F,S),v,t)}return q.all(A(Object.keys(F),function(e){return F[e].length?r.update(e,F[e],j):null}))}).then(function(){var r,t={};t[T]={},t[T][k]=z;for(r in F)h(F[r],D),F[r].length&&(r!==k?t[T][r]=F[r]:t[T][k]=t[T][k].concat(F[k]));return S.emit(O,t),e})}},{"../common/apply_update":6,"../common/array/find":8,"../common/array/includes":9,"../common/array/map":10,"../common/assign":14,"../common/clone":17,"../common/constants":18,"../common/deep_equal":19,"../common/errors":20,"../common/message":25,"../common/promise":27,"../record_type/enforce":42,"./check_links":30,"./update_helpers":38,"./validate_records":39}],38:[function(e,r,t){"use strict";var n=e("../common/array/find"),o=e("../common/keys").primary;t.getUpdate=function(e,r,t,i){var s;return i[e]&&i[e][r]?n(t[e],function(e){return e[o]===r}):(s={id:r},t[e]||(t[e]=[]),t[e].push(s),i[e]={},i[e][r]=!0,s)},t.addId=function(e,r,t,n){if(n)return r.push||(r.push={}),r.push[t]||(r.push[t]=[]),void r.push[t].push(e);r.replace||(r.replace={}),r.replace[t]=e},t.removeId=function(e,r,t,n){if(n)return r.pull||(r.pull={}),r.pull[t]||(r.pull[t]=[]),void r.pull[t].push(e);r.replace||(r.replace={}),r.replace[t]=null},t.scrubDenormalizedUpdates=function(e,r){var t,n,i,s;for(t=e.length;t--;){n=e[t];for(i in n)if(i!==o){for(s in n[i])s in r&&delete n[i][s];Object.keys(n[i]).length||delete n[i]}1===Object.keys(n).length&&e.splice(t,1)}}},{"../common/array/find":8,"../common/keys":24}],39:[function(e,r,t){"use strict";var n=e("../common/message"),o=e("../common/errors").ConflictError,i=e("../common/keys"),s=i.link,a=i.isArray,u=i.inverse;r.exports=function(e,r,t,i){var c,f,l,p,h,d,y,m,g,v,w,b,E,A,k,O,T=this.recordTypes,_=i.language,I={};for(c=0,f=t.length;c<f;c++){if(m=t[c],E=r[m][s],A=r[m][u],k=r[m][a],O=T[E][A][a],k)for(l=0,p=e.length;l<p;l++)if(g=e[l],Array.isArray(g[m]))for(b={},h=0,d=(w=g[m]).length;h<d;h++){if(v=w[h],b.hasOwnProperty(v))throw new o(n("CollisionDuplicate",_,{id:v,field:m}));b[v]=!0}if(!O)for(I[m]={},l=0,p=e.length;l<p;l++)for(y=(g=e[l])[m],h=0,d=(w=Array.isArray(y)?y:y?[y]:[]).length;h<d;h++){if(v=w[h],I[m].hasOwnProperty(v))throw new o(n("CollisionToOne",_,{field:m}));I[m][v]=!0}}}},{"../common/errors":20,"../common/keys":24,"../common/message":25}],40:[function(e,r,t){"use strict";window.fortune=e("./")},{"./":41}],41:[function(e,r,t){"use strict";function n(e,r){if(!(this instanceof n))return new n(e,r);this.constructor(e,r)}var o=e("event-lite"),i=e("./adapter/adapters/memory"),s=e("./adapter/singleton"),a=e("./record_type/validate"),u=e("./record_type/ensure_types"),c=e("./common/promise"),f=e("./dispatch"),l=f.middlewares,p=e("./adapter"),h=e("./common"),d=h.assign,y=h.methods,m=h.events;(n.prototype=new o).constructor=function(e,r){var t,n,o,u,c,f,d,m,g={},v=h.message.copy();void 0===e&&(e={}),void 0===r&&(r={}),"adapter"in r||(r.adapter=[i(p)]),"settings"in r||(r.settings={}),"hooks"in r||(r.hooks={}),"enforceLinks"in r.settings||(r.settings.enforceLinks=!0),u={};for(n in y){for(d=0,m=(o=[l[n],l.include,l.end]).length;d<m;d++)o[d]=function(e,r){return function(t){return r.call(e,t)}}(this,o[d]);u[y[n]]=o}f=r.hooks;for(c in f){if(!e.hasOwnProperty(c))throw new Error('Attempted to define hook on "'+c+'" type which does not exist.');if(!Array.isArray(f[c]))throw new TypeError('Hook value for "'+c+'" type must be an array.')}for(c in e){if(c in g)throw new Error('Can not define type name "'+c+'" which is in Object.prototype.');a(e[c]),f.hasOwnProperty(c)||(f[c]=[])}t=new s({adapter:r.adapter,recordTypes:e,hooks:f,message:v}),Object.defineProperties(this,{connectionStatus:{value:0,writable:!0},options:{value:r},hooks:{value:f},recordTypes:{value:e,enumerable:!0},message:{value:v,enumerable:!0},adapter:{value:t,enumerable:!0,configurable:!0},flows:{value:u}})},n.prototype.request=function(e){var r=this,t=r.connectionStatus,n=c.Promise;return 0===t?r.connect().then(function(){return f.call(r,e)}):1===t?new n(function(t,n){r.once(m.failure,function(){n(new Error("Connection failed."))}),r.once(m.connect,function(){t(f.call(r,e))})}):f.call(r,e)},n.prototype.find=function(e,r,t,n,o){var i={method:y.find,type:e};return r&&(i.ids=Array.isArray(r)?r:[r]),t&&(i.options=t),n&&(i.include=n),o&&(i.meta=o),this.request(i)},n.prototype.create=function(e,r,t,n){var o={method:y.create,type:e,payload:Array.isArray(r)?r:[r]};return t&&(o.include=t),n&&(o.meta=n),this.request(o)},n.prototype.update=function(e,r,t,n){var o={method:y.update,type:e,payload:Array.isArray(r)?r:[r]};return t&&(o.include=t),n&&(o.meta=n),this.request(o)},n.prototype.delete=function(e,r,t,n){var o={method:y.delete,type:e};return r&&(o.ids=Array.isArray(r)?r:[r]),t&&(o.include=t),n&&(o.meta=n),this.request(o)},n.prototype.connect=function(){var e=this,r=c.Promise;return 1===e.connectionStatus?r.reject(new Error("Connection is in progress.")):2===e.connectionStatus?r.reject(new Error("Connection is already done.")):(e.connectionStatus=1,new r(function(r,t){Object.defineProperty(e,"denormalizedFields",{value:u(e.recordTypes),writable:!0,configurable:!0}),e.adapter.connect().then(function(){return e.connectionStatus=2,e.emit(m.connect),r(e)},function(r){return e.connectionStatus=0,e.emit(m.failure),t(r)})}))},n.prototype.disconnect=function(){var e=this,r=c.Promise;return 2!==e.connectionStatus?r.reject(new Error("Instance has not been connected.")):(e.connectionStatus=1,new r(function(r,t){return e.adapter.disconnect().then(function(){return e.connectionStatus=0,e.emit(m.disconnect),r(e)},function(r){return e.connectionStatus=2,e.emit(m.failure),t(r)})}))},n.prototype.common=h,d(n,{Adapter:p,adapters:{memory:i(p)},errors:h.errors,message:h.message,methods:y,events:m}),Object.defineProperty(n,"Promise",{enumerable:!0,get:function(){return c.Promise},set:function(e){c.Promise=e}}),r.exports=n},{"./adapter":4,"./adapter/adapters/memory":3,"./adapter/singleton":5,"./common":23,"./common/promise":27,"./dispatch":36,"./record_type/ensure_types":43,"./record_type/validate":44,"event-lite":48}],42:[function(e,r,t){(function(t){"use strict";function n(e,r,t,n){var a,u=n.language,f=e[c];if(null!==t&&(a=i(p,function(e){return e[0]===f}),!(a=a?a[1]:f)(t)))throw new s(o(e[l]?"EnforceValueArray":"EnforceValue",u,{key:r,type:f.displayName||f.name}))}var o=e("../common/message"),i=e("../common/array/find"),s=e("../common/errors").BadRequestError,a=e("../common/keys"),u=a.primary,c=a.type,f=a.link,l=a.isArray,p=[[String,function(e){return"string"==typeof e}],[Number,function(e){return"number"==typeof e}],[Boolean,function(e){return"boolean"==typeof e}],[Date,function(e){return e&&"function"==typeof e.getTime&&!Number.isNaN(e.getTime())}],[Object,function(e){return null!==e&&"object"==typeof e}],[t,function(e){return t.isBuffer(e)}]];r.exports=function(e,r,t,a){var p,h,d,y,m,g;a||(a={}),g=a.language;for(d in r)if(m=t[d])if(y=r[d],m[c])if(m[l]){if(!Array.isArray(y))throw new s(o("EnforceArrayType",g,{key:d,type:m[c].name}));for(p=0,h=y.length;p<h;p++)n(m,d,y[p],a)}else n(m,d,y,a);else if(m[f]){if(m[l]){if(!Array.isArray(y))throw new s(o("EnforceArray",g,{key:d}));if(e===m[f]&&i(y,function(e){return function(r){return e===r}}(r[u])))throw new s(o("EnforceSameID",g,{key:d}));continue}if(Array.isArray(y))throw new s(o("EnforceSingular",g,{key:d}));if(e===m[f]&&r[u]===y)throw new s(o("EnforceSameID",g,{key:d}))}else;else d!==u&&delete r[d];return r}}).call(this,e("buffer").Buffer)},{"../common/array/find":8,"../common/errors":20,"../common/keys":24,"../common/message":25,buffer:46}],43:[function(e,r,t){"use strict";var n=e("../common/keys"),o=n.link,i=n.inverse,s=n.isArray,a=n.denormalizedInverse;r.exports=function(e){var r,t,n,u,c,f,l={};for(r in e)for(t in e[r])if(n=e[r][t],o in n){if(!e.hasOwnProperty(n[o]))throw new Error('The value for "'+o+'" on "'+t+'" in type "'+r+'" is invalid, the record type does not exist.');if(u=e[n[o]],i in n){if(!u.hasOwnProperty(n[i]))throw new Error('The value for "'+i+'" on "'+t+'" in type "'+r+'" is invalid, the field does not exist.');if(u[n[i]][i]!==t)throw new Error('The value for "'+i+'" on "'+t+'" in type "'+r+'" is invalid, the inversely related field must define its inverse as "'+t+'".');if(u[n[i]][o]!==r)throw new Error('The value for "'+o+'" on "'+t+'" in type "'+r+'" is invalid, the inversely related field must define its link as "'+r+'".')}else l[c="__"+r+"_"+t+"_inverse"]=!0,Object.defineProperty(n,i,{value:c}),(f={})[o]=r,f[i]=t,f[s]=!0,f[a]=!0,Object.defineProperty(u,c,{value:f})}return l}},{"../common/keys":24}],44:[function(e,r,t){(function(t){"use strict";function n(e,r){var t=e[r]=function(e){var r;if("string"==typeof e)r={link:e};else if("function"==typeof e)r={type:e};else{if(!Array.isArray(e))return e;r={},e[1]?r.inverse=e[1]:r.isArray=!0,Array.isArray(e[0])?(r.isArray=!0,e=e[0][0]):e=e[0],"string"==typeof e?r.link=e:"function"==typeof e&&(r.type=e)}return r}(e[r]);if("object"!=typeof t||t.constructor!==Object)throw new TypeError('The definition of "'+r+'" must be an object.');if(r===a)throw new Error('Can not define primary key "'+a+'".');if(r in p)throw new Error('Can not define field name "'+r+'" which is in Object.prototype.');if(!t[u]&&!t[c])throw new Error('The definition of "'+r+'" must contain either the "'+u+'" or "'+c+'" property.');if(t[u]&&t[c])throw new Error('Can not define both "'+u+'" and "'+c+'" on "'+r+'".');if(t[u]){if("string"==typeof t[u]&&(t[u]=h[d.indexOf(t[u].toLowerCase())]),"function"!=typeof t[u])throw new Error('The "'+u+'" on "'+r+'" must be a function.');if(!o(h,function(e){return e===t[u].prototype.constructor}))throw new Error('The "'+u+'" on "'+r+'" must inherit from a valid native type.');if(t[f])throw new Error('The field "'+f+'" may not be defined on "'+r+'".')}if(t[c]){if("string"!=typeof t[c])throw new TypeError('The "'+c+'" on "'+r+'" must be a string.');if(t[f]&&"string"!=typeof t[f])throw new TypeError('The "'+f+'" on "'+r+'" must be a string.')}if(t[l]&&"boolean"!=typeof t[l])throw new TypeError('The key "'+l+'" on "'+r+'" must be a boolean.')}var o=e("../common/array/find"),i=e("../common/array/map"),s=e("../common/keys"),a=s.primary,u=s.type,c=s.link,f=s.inverse,l=s.isArray,p={},h=[String,Number,Boolean,Date,Object,t],d=i(h,function(e){return e.name.toLowerCase()});r.exports=function(e){var r;if("object"!=typeof e)throw new TypeError("Type definition must be an object.");for(r in e)n(e,r);return e}}).call(this,e("buffer").Buffer)},{"../common/array/find":8,"../common/array/map":10,"../common/keys":24,buffer:46}],45:[function(e,r,t){"use strict";function n(e){var r=e.length;if(r%4>0)throw new Error("Invalid string. Length must be a multiple of 4");return"="===e[r-2]?2:"="===e[r-1]?1:0}function o(e){return s[e>>18&63]+s[e>>12&63]+s[e>>6&63]+s[63&e]}function i(e,r,t){for(var n,i=[],s=r;s<t;s+=3)n=(e[s]<<16)+(e[s+1]<<8)+e[s+2],i.push(o(n));return i.join("")}t.byteLength=function(e){return 3*e.length/4-n(e)},t.toByteArray=function(e){var r,t,o,i,s,c=e.length;i=n(e),s=new u(3*c/4-i),t=i>0?c-4:c;var f=0;for(r=0;r<t;r+=4)o=a[e.charCodeAt(r)]<<18|a[e.charCodeAt(r+1)]<<12|a[e.charCodeAt(r+2)]<<6|a[e.charCodeAt(r+3)],s[f++]=o>>16&255,s[f++]=o>>8&255,s[f++]=255&o;return 2===i?(o=a[e.charCodeAt(r)]<<2|a[e.charCodeAt(r+1)]>>4,s[f++]=255&o):1===i&&(o=a[e.charCodeAt(r)]<<10|a[e.charCodeAt(r+1)]<<4|a[e.charCodeAt(r+2)]>>2,s[f++]=o>>8&255,s[f++]=255&o),s},t.fromByteArray=function(e){for(var r,t=e.length,n=t%3,o="",a=[],u=0,c=t-n;u<c;u+=16383)a.push(i(e,u,u+16383>c?c:u+16383));return 1===n?(r=e[t-1],o+=s[r>>2],o+=s[r<<4&63],o+="=="):2===n&&(r=(e[t-2]<<8)+e[t-1],o+=s[r>>10],o+=s[r>>4&63],o+=s[r<<2&63],o+="="),a.push(o),a.join("")};for(var s=[],a=[],u="undefined"!=typeof Uint8Array?Uint8Array:Array,c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",f=0,l=c.length;f<l;++f)s[f]=c[f],a[c.charCodeAt(f)]=f;a["-".charCodeAt(0)]=62,a["_".charCodeAt(0)]=63},{}],46:[function(e,r,t){"use strict";function n(e){if(e>q)throw new RangeError("Invalid typed array length");var r=new Uint8Array(e);return r.__proto__=o.prototype,r}function o(e,r,t){if("number"==typeof e){if("string"==typeof r)throw new Error("If encoding is specified then the first argument must be a string");return a(e)}return i(e,r,t)}function i(e,r,t){if("number"==typeof e)throw new TypeError('"value" argument must not be a number');return x(e)?function(e,r,t){if(r<0||e.byteLength<r)throw new RangeError("'offset' is out of bounds");if(e.byteLength<r+(t||0))throw new RangeError("'length' is out of bounds");var n;n=void 0===r&&void 0===t?new Uint8Array(e):void 0===t?new Uint8Array(e,r):new Uint8Array(e,r,t);return n.__proto__=o.prototype,n}(e,r,t):"string"==typeof e?function(e,r){"string"==typeof r&&""!==r||(r="utf8");if(!o.isEncoding(r))throw new TypeError('"encoding" must be a valid string encoding');var t=0|f(e,r),i=n(t),s=i.write(e,r);s!==t&&(i=i.slice(0,s));return i}(e,r):function(e){if(o.isBuffer(e)){var r=0|c(e.length),t=n(r);return 0===t.length?t:(e.copy(t,0,0,r),t)}if(e){if(R(e)||"length"in e)return"number"!=typeof e.length||U(e.length)?n(0):u(e);if("Buffer"===e.type&&Array.isArray(e.data))return u(e.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(e)}function s(e){if("number"!=typeof e)throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative')}function a(e){return s(e),n(e<0?0:0|c(e))}function u(e){for(var r=e.length<0?0:0|c(e.length),t=n(r),o=0;o<r;o+=1)t[o]=255&e[o];return t}function c(e){if(e>=q)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+q.toString(16)+" bytes");return 0|e}function f(e,r){if(o.isBuffer(e))return e.length;if(R(e)||x(e))return e.byteLength;"string"!=typeof e&&(e=""+e);var t=e.length;if(0===t)return 0;for(var n=!1;;)switch(r){case"ascii":case"latin1":case"binary":return t;case"utf8":case"utf-8":case void 0:return I(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*t;case"hex":return t>>>1;case"base64":return P(e).length;default:if(n)return I(e).length;r=(""+r).toLowerCase(),n=!0}}function l(e,r,t){var n=!1;if((void 0===r||r<0)&&(r=0),r>this.length)return"";if((void 0===t||t>this.length)&&(t=this.length),t<=0)return"";if(t>>>=0,r>>>=0,t<=r)return"";for(e||(e="utf8");;)switch(e){case"hex":return function(e,r,t){var n=e.length;(!r||r<0)&&(r=0);(!t||t<0||t>n)&&(t=n);for(var o="",i=r;i<t;++i)o+=function(e){return e<16?"0"+e.toString(16):e.toString(16)}(e[i]);return o}(this,r,t);case"utf8":case"utf-8":return E(this,r,t);case"ascii":return function(e,r,t){var n="";t=Math.min(e.length,t);for(var o=r;o<t;++o)n+=String.fromCharCode(127&e[o]);return n}(this,r,t);case"latin1":case"binary":return function(e,r,t){var n="";t=Math.min(e.length,t);for(var o=r;o<t;++o)n+=String.fromCharCode(e[o]);return n}(this,r,t);case"base64":return function(e,r,t){return 0===r&&t===e.length?j.fromByteArray(e):j.fromByteArray(e.slice(r,t))}(this,r,t);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return function(e,r,t){for(var n=e.slice(r,t),o="",i=0;i<n.length;i+=2)o+=String.fromCharCode(n[i]+256*n[i+1]);return o}(this,r,t);default:if(n)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),n=!0}}function p(e,r,t){var n=e[r];e[r]=e[t],e[t]=n}function h(e,r,t,n,i){if(0===e.length)return-1;if("string"==typeof t?(n=t,t=0):t>2147483647?t=2147483647:t<-2147483648&&(t=-2147483648),t=+t,U(t)&&(t=i?0:e.length-1),t<0&&(t=e.length+t),t>=e.length){if(i)return-1;t=e.length-1}else if(t<0){if(!i)return-1;t=0}if("string"==typeof r&&(r=o.from(r,n)),o.isBuffer(r))return 0===r.length?-1:d(e,r,t,n,i);if("number"==typeof r)return r&=255,"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(e,r,t):Uint8Array.prototype.lastIndexOf.call(e,r,t):d(e,[r],t,n,i);throw new TypeError("val must be string, number or Buffer")}function d(e,r,t,n,o){function i(e,r){return 1===s?e[r]:e.readUInt16BE(r*s)}var s=1,a=e.length,u=r.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(e.length<2||r.length<2)return-1;s=2,a/=2,u/=2,t/=2}var c;if(o){var f=-1;for(c=t;c<a;c++)if(i(e,c)===i(r,-1===f?0:c-f)){if(-1===f&&(f=c),c-f+1===u)return f*s}else-1!==f&&(c-=c-f),f=-1}else for(t+u>a&&(t=a-u),c=t;c>=0;c--){for(var l=!0,p=0;p<u;p++)if(i(e,c+p)!==i(r,p)){l=!1;break}if(l)return c}return-1}function y(e,r,t,n){t=Number(t)||0;var o=e.length-t;n?(n=Number(n))>o&&(n=o):n=o;var i=r.length;if(i%2!=0)throw new TypeError("Invalid hex string");n>i/2&&(n=i/2);for(var s=0;s<n;++s){var a=parseInt(r.substr(2*s,2),16);if(U(a))return s;e[t+s]=a}return s}function m(e,r,t,n){return B(I(r,e.length-t),e,t,n)}function g(e,r,t,n){return B(function(e){for(var r=[],t=0;t<e.length;++t)r.push(255&e.charCodeAt(t));return r}(r),e,t,n)}function v(e,r,t,n){return g(e,r,t,n)}function w(e,r,t,n){return B(P(r),e,t,n)}function b(e,r,t,n){return B(function(e,r){for(var t,n,o,i=[],s=0;s<e.length&&!((r-=2)<0);++s)t=e.charCodeAt(s),n=t>>8,o=t%256,i.push(o),i.push(n);return i}(r,e.length-t),e,t,n)}function E(e,r,t){t=Math.min(e.length,t);for(var n=[],o=r;o<t;){var i=e[o],s=null,a=i>239?4:i>223?3:i>191?2:1;if(o+a<=t){var u,c,f,l;switch(a){case 1:i<128&&(s=i);break;case 2:128==(192&(u=e[o+1]))&&(l=(31&i)<<6|63&u)>127&&(s=l);break;case 3:u=e[o+1],c=e[o+2],128==(192&u)&&128==(192&c)&&(l=(15&i)<<12|(63&u)<<6|63&c)>2047&&(l<55296||l>57343)&&(s=l);break;case 4:u=e[o+1],c=e[o+2],f=e[o+3],128==(192&u)&&128==(192&c)&&128==(192&f)&&(l=(15&i)<<18|(63&u)<<12|(63&c)<<6|63&f)>65535&&l<1114112&&(s=l)}}null===s?(s=65533,a=1):s>65535&&(s-=65536,n.push(s>>>10&1023|55296),s=56320|1023&s),n.push(s),o+=a}return function(e){var r=e.length;if(r<=S)return String.fromCharCode.apply(String,e);var t="",n=0;for(;n<r;)t+=String.fromCharCode.apply(String,e.slice(n,n+=S));return t}(n)}function A(e,r,t){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+r>t)throw new RangeError("Trying to access beyond buffer length")}function k(e,r,t,n,i,s){if(!o.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(r>i||r<s)throw new RangeError('"value" argument is out of bounds');if(t+n>e.length)throw new RangeError("Index out of range")}function O(e,r,t,n,o,i){if(t+n>e.length)throw new RangeError("Index out of range");if(t<0)throw new RangeError("Index out of range")}function T(e,r,t,n,o){return r=+r,t>>>=0,o||O(e,0,t,4),C.write(e,r,t,n,23,4),t+4}function _(e,r,t,n,o){return r=+r,t>>>=0,o||O(e,0,t,8),C.write(e,r,t,n,52,8),t+8}function I(e,r){r=r||1/0;for(var t,n=e.length,o=null,i=[],s=0;s<n;++s){if((t=e.charCodeAt(s))>55295&&t<57344){if(!o){if(t>56319){(r-=3)>-1&&i.push(239,191,189);continue}if(s+1===n){(r-=3)>-1&&i.push(239,191,189);continue}o=t;continue}if(t<56320){(r-=3)>-1&&i.push(239,191,189),o=t;continue}t=65536+(o-55296<<10|t-56320)}else o&&(r-=3)>-1&&i.push(239,191,189);if(o=null,t<128){if((r-=1)<0)break;i.push(t)}else if(t<2048){if((r-=2)<0)break;i.push(t>>6|192,63&t|128)}else if(t<65536){if((r-=3)<0)break;i.push(t>>12|224,t>>6&63|128,63&t|128)}else{if(!(t<1114112))throw new Error("Invalid code point");if((r-=4)<0)break;i.push(t>>18|240,t>>12&63|128,t>>6&63|128,63&t|128)}}return i}function P(e){return j.toByteArray(function(e){if((e=e.trim().replace(D,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function B(e,r,t,n){for(var o=0;o<n&&!(o+t>=r.length||o>=e.length);++o)r[o+t]=e[o];return o}function x(e){return e instanceof ArrayBuffer||null!=e&&null!=e.constructor&&"ArrayBuffer"===e.constructor.name&&"number"==typeof e.byteLength}function R(e){return"function"==typeof ArrayBuffer.isView&&ArrayBuffer.isView(e)}function U(e){return e!=e}var j=e("base64-js"),C=e("ieee754");t.Buffer=o,t.SlowBuffer=function(e){return+e!=e&&(e=0),o.alloc(+e)},t.INSPECT_MAX_BYTES=50;var q=2147483647;t.kMaxLength=q,(o.TYPED_ARRAY_SUPPORT=function(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()}catch(e){return!1}}())||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),"undefined"!=typeof Symbol&&Symbol.species&&o[Symbol.species]===o&&Object.defineProperty(o,Symbol.species,{value:null,configurable:!0,enumerable:!1,writable:!1}),o.poolSize=8192,o.from=function(e,r,t){return i(e,r,t)},o.prototype.__proto__=Uint8Array.prototype,o.__proto__=Uint8Array,o.alloc=function(e,r,t){return function(e,r,t){return s(e),e<=0?n(e):void 0!==r?"string"==typeof t?n(e).fill(r,t):n(e).fill(r):n(e)}(e,r,t)},o.allocUnsafe=function(e){return a(e)},o.allocUnsafeSlow=function(e){return a(e)},o.isBuffer=function(e){return null!=e&&!0===e._isBuffer},o.compare=function(e,r){if(!o.isBuffer(e)||!o.isBuffer(r))throw new TypeError("Arguments must be Buffers");if(e===r)return 0;for(var t=e.length,n=r.length,i=0,s=Math.min(t,n);i<s;++i)if(e[i]!==r[i]){t=e[i],n=r[i];break}return t<n?-1:n<t?1:0},o.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},o.concat=function(e,r){if(!Array.isArray(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return o.alloc(0);var t;if(void 0===r)for(r=0,t=0;t<e.length;++t)r+=e[t].length;var n=o.allocUnsafe(r),i=0;for(t=0;t<e.length;++t){var s=e[t];if(!o.isBuffer(s))throw new TypeError('"list" argument must be an Array of Buffers');s.copy(n,i),i+=s.length}return n},o.byteLength=f,o.prototype._isBuffer=!0,o.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var r=0;r<e;r+=2)p(this,r,r+1);return this},o.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var r=0;r<e;r+=4)p(this,r,r+3),p(this,r+1,r+2);return this},o.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var r=0;r<e;r+=8)p(this,r,r+7),p(this,r+1,r+6),p(this,r+2,r+5),p(this,r+3,r+4);return this},o.prototype.toString=function(){var e=this.length;return 0===e?"":0===arguments.length?E(this,0,e):l.apply(this,arguments)},o.prototype.equals=function(e){if(!o.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===o.compare(this,e)},o.prototype.inspect=function(){var e="",r=t.INSPECT_MAX_BYTES;return this.length>0&&(e=this.toString("hex",0,r).match(/.{2}/g).join(" "),this.length>r&&(e+=" ... ")),"<Buffer "+e+">"},o.prototype.compare=function(e,r,t,n,i){if(!o.isBuffer(e))throw new TypeError("Argument must be a Buffer");if(void 0===r&&(r=0),void 0===t&&(t=e?e.length:0),void 0===n&&(n=0),void 0===i&&(i=this.length),r<0||t>e.length||n<0||i>this.length)throw new RangeError("out of range index");if(n>=i&&r>=t)return 0;if(n>=i)return-1;if(r>=t)return 1;if(r>>>=0,t>>>=0,n>>>=0,i>>>=0,this===e)return 0;for(var s=i-n,a=t-r,u=Math.min(s,a),c=this.slice(n,i),f=e.slice(r,t),l=0;l<u;++l)if(c[l]!==f[l]){s=c[l],a=f[l];break}return s<a?-1:a<s?1:0},o.prototype.includes=function(e,r,t){return-1!==this.indexOf(e,r,t)},o.prototype.indexOf=function(e,r,t){return h(this,e,r,t,!0)},o.prototype.lastIndexOf=function(e,r,t){return h(this,e,r,t,!1)},o.prototype.write=function(e,r,t,n){if(void 0===r)n="utf8",t=this.length,r=0;else if(void 0===t&&"string"==typeof r)n=r,t=this.length,r=0;else{if(!isFinite(r))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");r>>>=0,isFinite(t)?(t>>>=0,void 0===n&&(n="utf8")):(n=t,t=void 0)}var o=this.length-r;if((void 0===t||t>o)&&(t=o),e.length>0&&(t<0||r<0)||r>this.length)throw new RangeError("Attempt to write outside buffer bounds");n||(n="utf8");for(var i=!1;;)switch(n){case"hex":return y(this,e,r,t);case"utf8":case"utf-8":return m(this,e,r,t);case"ascii":return g(this,e,r,t);case"latin1":case"binary":return v(this,e,r,t);case"base64":return w(this,e,r,t);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return b(this,e,r,t);default:if(i)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),i=!0}},o.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var S=4096;o.prototype.slice=function(e,r){var t=this.length;e=~~e,r=void 0===r?t:~~r,e<0?(e+=t)<0&&(e=0):e>t&&(e=t),r<0?(r+=t)<0&&(r=0):r>t&&(r=t),r<e&&(r=e);var n=this.subarray(e,r);return n.__proto__=o.prototype,n},o.prototype.readUIntLE=function(e,r,t){e>>>=0,r>>>=0,t||A(e,r,this.length);for(var n=this[e],o=1,i=0;++i<r&&(o*=256);)n+=this[e+i]*o;return n},o.prototype.readUIntBE=function(e,r,t){e>>>=0,r>>>=0,t||A(e,r,this.length);for(var n=this[e+--r],o=1;r>0&&(o*=256);)n+=this[e+--r]*o;return n},o.prototype.readUInt8=function(e,r){return e>>>=0,r||A(e,1,this.length),this[e]},o.prototype.readUInt16LE=function(e,r){return e>>>=0,r||A(e,2,this.length),this[e]|this[e+1]<<8},o.prototype.readUInt16BE=function(e,r){return e>>>=0,r||A(e,2,this.length),this[e]<<8|this[e+1]},o.prototype.readUInt32LE=function(e,r){return e>>>=0,r||A(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},o.prototype.readUInt32BE=function(e,r){return e>>>=0,r||A(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},o.prototype.readIntLE=function(e,r,t){e>>>=0,r>>>=0,t||A(e,r,this.length);for(var n=this[e],o=1,i=0;++i<r&&(o*=256);)n+=this[e+i]*o;return o*=128,n>=o&&(n-=Math.pow(2,8*r)),n},o.prototype.readIntBE=function(e,r,t){e>>>=0,r>>>=0,t||A(e,r,this.length);for(var n=r,o=1,i=this[e+--n];n>0&&(o*=256);)i+=this[e+--n]*o;return o*=128,i>=o&&(i-=Math.pow(2,8*r)),i},o.prototype.readInt8=function(e,r){return e>>>=0,r||A(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},o.prototype.readInt16LE=function(e,r){e>>>=0,r||A(e,2,this.length);var t=this[e]|this[e+1]<<8;return 32768&t?4294901760|t:t},o.prototype.readInt16BE=function(e,r){e>>>=0,r||A(e,2,this.length);var t=this[e+1]|this[e]<<8;return 32768&t?4294901760|t:t},o.prototype.readInt32LE=function(e,r){return e>>>=0,r||A(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},o.prototype.readInt32BE=function(e,r){return e>>>=0,r||A(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},o.prototype.readFloatLE=function(e,r){return e>>>=0,r||A(e,4,this.length),C.read(this,e,!0,23,4)},o.prototype.readFloatBE=function(e,r){return e>>>=0,r||A(e,4,this.length),C.read(this,e,!1,23,4)},o.prototype.readDoubleLE=function(e,r){return e>>>=0,r||A(e,8,this.length),C.read(this,e,!0,52,8)},o.prototype.readDoubleBE=function(e,r){return e>>>=0,r||A(e,8,this.length),C.read(this,e,!1,52,8)},o.prototype.writeUIntLE=function(e,r,t,n){if(e=+e,r>>>=0,t>>>=0,!n){k(this,e,r,t,Math.pow(2,8*t)-1,0)}var o=1,i=0;for(this[r]=255&e;++i<t&&(o*=256);)this[r+i]=e/o&255;return r+t},o.prototype.writeUIntBE=function(e,r,t,n){if(e=+e,r>>>=0,t>>>=0,!n){k(this,e,r,t,Math.pow(2,8*t)-1,0)}var o=t-1,i=1;for(this[r+o]=255&e;--o>=0&&(i*=256);)this[r+o]=e/i&255;return r+t},o.prototype.writeUInt8=function(e,r,t){return e=+e,r>>>=0,t||k(this,e,r,1,255,0),this[r]=255&e,r+1},o.prototype.writeUInt16LE=function(e,r,t){return e=+e,r>>>=0,t||k(this,e,r,2,65535,0),this[r]=255&e,this[r+1]=e>>>8,r+2},o.prototype.writeUInt16BE=function(e,r,t){return e=+e,r>>>=0,t||k(this,e,r,2,65535,0),this[r]=e>>>8,this[r+1]=255&e,r+2},o.prototype.writeUInt32LE=function(e,r,t){return e=+e,r>>>=0,t||k(this,e,r,4,4294967295,0),this[r+3]=e>>>24,this[r+2]=e>>>16,this[r+1]=e>>>8,this[r]=255&e,r+4},o.prototype.writeUInt32BE=function(e,r,t){return e=+e,r>>>=0,t||k(this,e,r,4,4294967295,0),this[r]=e>>>24,this[r+1]=e>>>16,this[r+2]=e>>>8,this[r+3]=255&e,r+4},o.prototype.writeIntLE=function(e,r,t,n){if(e=+e,r>>>=0,!n){var o=Math.pow(2,8*t-1);k(this,e,r,t,o-1,-o)}var i=0,s=1,a=0;for(this[r]=255&e;++i<t&&(s*=256);)e<0&&0===a&&0!==this[r+i-1]&&(a=1),this[r+i]=(e/s>>0)-a&255;return r+t},o.prototype.writeIntBE=function(e,r,t,n){if(e=+e,r>>>=0,!n){var o=Math.pow(2,8*t-1);k(this,e,r,t,o-1,-o)}var i=t-1,s=1,a=0;for(this[r+i]=255&e;--i>=0&&(s*=256);)e<0&&0===a&&0!==this[r+i+1]&&(a=1),this[r+i]=(e/s>>0)-a&255;return r+t},o.prototype.writeInt8=function(e,r,t){return e=+e,r>>>=0,t||k(this,e,r,1,127,-128),e<0&&(e=255+e+1),this[r]=255&e,r+1},o.prototype.writeInt16LE=function(e,r,t){return e=+e,r>>>=0,t||k(this,e,r,2,32767,-32768),this[r]=255&e,this[r+1]=e>>>8,r+2},o.prototype.writeInt16BE=function(e,r,t){return e=+e,r>>>=0,t||k(this,e,r,2,32767,-32768),this[r]=e>>>8,this[r+1]=255&e,r+2},o.prototype.writeInt32LE=function(e,r,t){return e=+e,r>>>=0,t||k(this,e,r,4,2147483647,-2147483648),this[r]=255&e,this[r+1]=e>>>8,this[r+2]=e>>>16,this[r+3]=e>>>24,r+4},o.prototype.writeInt32BE=function(e,r,t){return e=+e,r>>>=0,t||k(this,e,r,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),this[r]=e>>>24,this[r+1]=e>>>16,this[r+2]=e>>>8,this[r+3]=255&e,r+4},o.prototype.writeFloatLE=function(e,r,t){return T(this,e,r,!0,t)},o.prototype.writeFloatBE=function(e,r,t){return T(this,e,r,!1,t)},o.prototype.writeDoubleLE=function(e,r,t){return _(this,e,r,!0,t)},o.prototype.writeDoubleBE=function(e,r,t){return _(this,e,r,!1,t)},o.prototype.copy=function(e,r,t,n){if(t||(t=0),n||0===n||(n=this.length),r>=e.length&&(r=e.length),r||(r=0),n>0&&n<t&&(n=t),n===t)return 0;if(0===e.length||0===this.length)return 0;if(r<0)throw new RangeError("targetStart out of bounds");if(t<0||t>=this.length)throw new RangeError("sourceStart out of bounds");if(n<0)throw new RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),e.length-r<n-t&&(n=e.length-r+t);var o,i=n-t;if(this===e&&t<r&&r<n)for(o=i-1;o>=0;--o)e[o+r]=this[o+t];else if(i<1e3)for(o=0;o<i;++o)e[o+r]=this[o+t];else Uint8Array.prototype.set.call(e,this.subarray(t,t+i),r);return i},o.prototype.fill=function(e,r,t,n){if("string"==typeof e){if("string"==typeof r?(n=r,r=0,t=this.length):"string"==typeof t&&(n=t,t=this.length),1===e.length){var i=e.charCodeAt(0);i<256&&(e=i)}if(void 0!==n&&"string"!=typeof n)throw new TypeError("encoding must be a string");if("string"==typeof n&&!o.isEncoding(n))throw new TypeError("Unknown encoding: "+n)}else"number"==typeof e&&(e&=255);if(r<0||this.length<r||this.length<t)throw new RangeError("Out of range index");if(t<=r)return this;r>>>=0,t=void 0===t?this.length:t>>>0,e||(e=0);var s;if("number"==typeof e)for(s=r;s<t;++s)this[s]=e;else{var a=o.isBuffer(e)?e:new o(e,n),u=a.length;for(s=0;s<t-r;++s)this[s+r]=a[s%u]}return this};var D=/[^+/0-9A-Za-z-_]/g},{"base64-js":45,ieee754:49}],47:[function(e,r,t){"use strict";function n(e){i?Error.captureStackTrace(this,this.constructor):Object.defineProperty(this,"stack",o(Error(e).stack)),Object.defineProperty(this,"message",o(void 0!==e?""+e:""))}function o(e){return{value:e,writable:!0,configurable:!0}}var i="captureStackTrace"in Error;r.exports=function(e){var r;if(!e||"string"!=typeof e)throw new TypeError('Argument "name" must be a non-empty string.');return r=new Function("setupError","return function "+e+" () { if (!(this instanceof "+e+")) return new ("+e+".bind.apply("+e+", Array.prototype.concat.apply([ null ], arguments))); setupError.apply(this, arguments); }")(n),r.prototype=Object.create(Error.prototype,{constructor:o(r),name:o(e)}),r}},{}],48:[function(e,r,t){function n(){if(!(this instanceof n))return new n}!function(e){function t(e){for(var r in s)e[r]=s[r];return e}function n(e,r){var t;if(arguments.length){if(r){if(t=o(this,e,!0)){if(!(t=t.filter(function(e){return e!==r&&e.originalListener!==r})).length)return n.call(this,e);this[i][e]=t}}else if((t=this[i])&&(delete t[e],!Object.keys(t).length))return n.call(this)}else delete this[i];return this}function o(e,r,t){if(!t||e[i]){var n=e[i]||(e[i]={});return n[r]||(n[r]=[])}}void 0!==r&&(r.exports=e);var i="listeners",s={on:function(e,r){return o(this,e).push(r),this},once:function(e,r){function t(){n.call(i,e,t),r.apply(this,arguments)}var i=this;return t.originalListener=r,o(i,e).push(t),i},off:n,emit:function(e,r){var t=this,n=o(t,e,!0);if(!n)return!1;var i=arguments.length;if(1===i)n.forEach(function(e){e.call(t)});else if(2===i)n.forEach(function(e){e.call(t,r)});else{var s=Array.prototype.slice.call(arguments,1);n.forEach(function(e){e.apply(t,s)})}return!!n.length}};t(e.prototype),e.mixin=t}(n)},{}],49:[function(e,r,t){t.read=function(e,r,t,n,o){var i,s,a=8*o-n-1,u=(1<<a)-1,c=u>>1,f=-7,l=t?o-1:0,p=t?-1:1,h=e[r+l];for(l+=p,i=h&(1<<-f)-1,h>>=-f,f+=a;f>0;i=256*i+e[r+l],l+=p,f-=8);for(s=i&(1<<-f)-1,i>>=-f,f+=n;f>0;s=256*s+e[r+l],l+=p,f-=8);if(0===i)i=1-c;else{if(i===u)return s?NaN:1/0*(h?-1:1);s+=Math.pow(2,n),i-=c}return(h?-1:1)*s*Math.pow(2,i-n)},t.write=function(e,r,t,n,o,i){var s,a,u,c=8*i-o-1,f=(1<<c)-1,l=f>>1,p=23===o?Math.pow(2,-24)-Math.pow(2,-77):0,h=n?0:i-1,d=n?1:-1,y=r<0||0===r&&1/r<0?1:0;for(r=Math.abs(r),isNaN(r)||r===1/0?(a=isNaN(r)?1:0,s=f):(s=Math.floor(Math.log(r)/Math.LN2),r*(u=Math.pow(2,-s))<1&&(s--,u*=2),(r+=s+l>=1?p/u:p*Math.pow(2,1-l))*u>=2&&(s++,u/=2),s+l>=f?(a=0,s=f):s+l>=1?(a=(r*u-1)*Math.pow(2,o),s+=l):(a=r*Math.pow(2,l-1)*Math.pow(2,o),s=0));o>=8;e[t+h]=255&a,h+=d,a/=256,o-=8);for(s=s<<o|a,c+=o;c>0;e[t+h]=255&s,h+=d,s/=256,c-=8);e[t+h-d]|=128*y}},{}],50:[function(e,r,t){function n(e){return!!e.constructor&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)}r.exports=function(e){return null!=e&&(n(e)||function(e){return"function"==typeof e.readFloatLE&&"function"==typeof e.slice&&n(e.slice(0,0))}(e)||!!e._isBuffer)}},{}]},{},[40]);
